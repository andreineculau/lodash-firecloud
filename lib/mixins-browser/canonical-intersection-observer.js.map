{"version":3,"sources":["../../src/mixins-browser/canonical-intersection-observer.ts"],"names":[],"mappings":"0HAAA;AACA,oE;;AAEO,MAAM,6BAAN,CAAoC;;;;;;;;;AASzC,EAAA,WAAW,CAAC,EAAD,EAAK,8BARV,SAQU,0CAFV,EAEU;AACd,SAAK,GAAL,GAAW,EAAX;AACD;;AAED,EAAA,OAAO,CAAC,OAAD,EAAmB,OAAnB,EAA4D;AACjE,QAAI,gBAAgB,GAAG,gBAAE,IAAF,CAAO,KAAK,cAAZ,EAA4B,UAAS,YAAT,EAAuB;AACxE,aAAO,YAAY,CAAC,OAAb,KAAyB,OAAzB,IAAoC,YAAY,CAAC,OAAb,KAAyB,OAApE;AACD,KAFsB,CAAvB;AAGA,QAAI,gBAAJ,EAAsB;AACpB;AACD;;AAED,QAAI,YAAY,GAAG,gBAAE,IAAF,CAAO,KAAK,cAAZ,EAA4B,UAAS,YAAT,EAAuB;AACpE,aAAO,YAAY,CAAC,OAAb,KAAyB,OAAhC;AACD,KAFkB,CAAnB;AAGA,QAAI,QAAJ;AACA,QAAI,gBAAE,WAAF,CAAc,YAAd,CAAJ,EAAiC;AAC/B,MAAA,QAAQ,GAAG,IAAI,oBAAW,oBAAf,CAAqC,OAAD,IAAa;AAC1D,aAAK,GAAL,CAAS,OAAT,EAAkB,IAAlB;AACD,OAFU,EAER,OAFQ,CAAX;AAGD,KAJD,MAIO;AACL,OAAC;AACC,QAAA,QADD;AAEG,MAAA,YAFJ;AAGD;;AAED,IAAA,QAAQ,CAAC,OAAT,CAAiB,OAAjB;AACA,SAAK,cAAL,CAAoB,IAApB,CAAyB;AACvB,MAAA,OADuB;AAEvB,MAAA,OAFuB;AAGvB,MAAA,QAHuB,EAAzB;;AAKD;;AAED,EAAA,SAAS,CAAC,OAAD,EAAmB,OAAnB,EAA4D;AACnE,QAAI,aAAa,GAAG,gBAAE,MAAF,CAAS,KAAK,cAAd,EAA8B,UAAS,YAAT,EAAuB;AACvE,aAAO,YAAY,CAAC,OAAb,KAAyB,OAAzB,IAAoC,YAAY,CAAC,OAAb,KAAyB,OAApE;AACD,KAFmB,CAApB;;AAIA,oBAAE,OAAF,CAAU,aAAV,EAAyB,UAAS,EAAC,OAAD,EAAU,QAAV,EAAT,EAA8B;AACrD,MAAA,QAAQ,CAAC,SAAT,CAAmB,OAAnB;AACD,KAFD;;AAIA;AACA,oBAAE,MAAF,CAAS,KAAK,cAAd,EAA8B,UAAS,YAAT,EAAuB;AACnD,aAAO,YAAY,CAAC,OAAb,KAAyB,OAAzB,IAAoC,YAAY,CAAC,OAAb,KAAyB,OAApE;AACD,KAFD;AAGD;;AAED,EAAA,UAAU,GAAS;AACjB,QAAI,SAAS,GAAG,gBAAE,GAAF,CAAM,KAAK,cAAX,EAA2B,UAAS,YAAT,EAAuB;AAChE,aAAO,YAAY,CAAC,QAApB;AACD,KAFe,CAAhB;AAGA,IAAA,SAAS,GAAG,gBAAE,IAAF,CAAO,SAAP,CAAZ;AACA,oBAAE,OAAF,CAAU,SAAV,EAAqB,UAAS,QAAT,EAAmB;AACtC,MAAA,QAAQ,CAAC,UAAT;AACD,KAFD;AAGA,SAAK,cAAL,GAAsB,EAAtB;AACD,GAnEwC,C","file":"canonical-intersection-observer.js","sourcesContent":["import _ from 'lodash';\nimport globalThis from './.global-this';\n\nexport class CanonicalIntersectionObserver {\n  _cb = undefined;\n\n  _observerPairs: {\n    element: Element;\n    options: IntersectionObserverInit;\n    observer: IntersectionObserver;\n  }[] = [];\n\n  constructor(cb) {\n    this._cb = cb;\n  }\n\n  observe(element: Element, options: IntersectionObserverInit): void {\n    let alreadyObserving = _.some(this._observerPairs, function(observerPair) {\n      return observerPair.element === element && observerPair.options === options;\n    });\n    if (alreadyObserving) {\n      return;\n    }\n\n    let observerPair = _.find(this._observerPairs, function(observerPair) {\n      return observerPair.options === options;\n    });\n    let observer: IntersectionObserver;\n    if (_.isUndefined(observerPair)) {\n      observer = new globalThis.IntersectionObserver((entries) => {\n        this._cb(entries, this);\n      }, options);\n    } else {\n      ({\n        observer\n      } = observerPair);\n    }\n\n    observer.observe(element);\n    this._observerPairs.push({\n      element,\n      options,\n      observer\n    });\n  }\n\n  unobserve(element: Element, options: IntersectionObserverInit): void {\n    let observerPairs = _.filter(this._observerPairs, function(observerPair) {\n      return observerPair.element === element && observerPair.options === options;\n    });\n\n    _.forEach(observerPairs, function({element, observer}) {\n      observer.unobserve(element);\n    });\n\n    // eslint-disable-next-line lodash/prefer-immutable-method\n    _.remove(this._observerPairs, function(observerPair) {\n      return observerPair.element === element && observerPair.options === options;\n    });\n  }\n\n  disconnect(): void {\n    let observers = _.map(this._observerPairs, function(observerPair) {\n      return observerPair.observer;\n    });\n    observers = _.uniq(observers);\n    _.forEach(observers, function(observer) {\n      observer.disconnect();\n    });\n    this._observerPairs = [];\n  }\n}\n"]}