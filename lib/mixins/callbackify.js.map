{"version":3,"sources":["../../src/mixins/callbackify.js"],"names":[],"mappings":"yGAAA;;AAEO,IAAI,WAAW,GAAG,UAAS,MAAT,EAAiB;AACxC,EAAA,aAAa,GAAG,KADwB;AAExC,EAAA,eAAe,GAAG,IAFsB;AAGxC,EAAA,YAAY,GAAG,KAHyB;AAItC,EAJqB,EAIjB;AACN;AACA,MAAI,CAAC,GAAG,IAAR;;AAEA,MAAI,EAAE,GAAG,UAAS,GAAG,IAAZ,EAAkB;AACzB,QAAI,YAAJ;AACA,QAAI,aAAJ,EAAmB;AACjB,MAAA,YAAY,GAAG,CAAC,CAAC,IAAF,CAAO,IAAP,CAAf;AACA,UAAI,CAAC,YAAL,EAAmB;AACjB,QAAA,IAAI,CAAC,KAAL;AACD;AACF,KALD,MAKO;AACL,MAAA,YAAY,GAAG,CAAC,CAAC,IAAF,CAAO,IAAP,CAAf;AACA,UAAI,CAAC,YAAL,EAAmB;AACjB,QAAA,IAAI,CAAC,GAAL;AACD;AACF;AACD,QAAI,QAAQ,GAAG,CAAC,GAAG,IAAJ,KAAa;AAC1B;AACA,MAAA,OAAO,CAAC,KAAR,CAAc,YAAd,EAA4B,IAA5B,EAAkC,IAAlC;AACA;AACD,KAJD;;AAMA,QAAI,YAAY,GAAG,UAAS,MAAT,EAAiB;AAClC,UAAI,eAAJ,EAAqB;AACnB,QAAA,UAAU,CAAC,QAAD,EAAW,CAAX,EAAc,SAAd,EAAyB,MAAzB,CAAV;AACD,OAFD,MAEO;AACL,QAAA,UAAU,CAAC,QAAD,EAAW,CAAX,EAAc,MAAd,CAAV;AACD;AACF,KAND;;AAQA,QAAI,UAAU,GAAG,UAAS,GAAT,EAAc;AAC7B,UAAI,eAAJ,EAAqB;AACnB,QAAA,UAAU,CAAC,QAAD,EAAW,CAAX,EAAc,GAAd,CAAV;AACD,OAFD,MAEO;AACL,QAAA,UAAU,CAAC,QAAD,EAAW,CAAX,CAAV;AACD;AACF,KAND;;AAQA;AACA,IAAA,OAAO,CAAC,KAAR,CAAc,MAAd,EAAsB,IAAtB,EAA4B,IAA5B,EAAkC,IAAlC,CAAuC,YAAvC,EAAqD,UAArD;AACA;AACD,GAtCD;;AAwCA,EAAA,MAAM,CAAC,cAAP,CAAsB,EAAtB,EAA0B,MAAM,CAAC,cAAP,CAAsB,MAAtB,CAA1B;AACA,EAAA,MAAM,CAAC,gBAAP,CAAwB,EAAxB,EAA4B,MAAM,CAAC,yBAAP,CAAiC,MAAjC,CAA5B;;AAEA,SAAO,EAAP;AACD,CApDM,C","file":"callbackify.js","sourcesContent":["// NOTE follows closely Node.js util.callbackify\n\nexport let callbackify = function(origFn, {\n  callbackFirst = false,\n  errorInCallback = true,\n  keepCallback = false\n} = {}) {\n  // eslint-disable-next-line consistent-this, no-invalid-this\n  let _ = this;\n\n  let fn = function(...args) {\n    let origCallback;\n    if (callbackFirst) {\n      origCallback = _.head(args);\n      if (!keepCallback) {\n        args.shift();\n      }\n    } else {\n      origCallback = _.last(args);\n      if (!keepCallback) {\n        args.pop();\n      }\n    }\n    let callback = (...args) => {\n      // eslint-disable-next-line no-invalid-this\n      Reflect.apply(origCallback, this, args);\n      // origCallback(...args);\n    };\n\n    let onFullfilled = function(result) {\n      if (errorInCallback) {\n        setTimeout(callback, 0, undefined, result);\n      } else {\n        setTimeout(callback, 0, result);\n      }\n    };\n\n    let onRejected = function(err) {\n      if (errorInCallback) {\n        setTimeout(callback, 0, err);\n      } else {\n        setTimeout(callback, 0);\n      }\n    };\n\n    // eslint-disable-next-line no-invalid-this\n    Reflect.apply(origFn, this, args).then(onFullfilled, onRejected);\n    // origFn(...args).then(onFullfilled, onRejected);\n  };\n\n  Object.setPrototypeOf(fn, Object.getPrototypeOf(origFn));\n  Object.defineProperties(fn, Object.getOwnPropertyDescriptors(origFn));\n\n  return fn;\n};\n"]}